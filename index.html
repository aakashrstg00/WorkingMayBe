<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body style="padding:'0px';overflow:hidden">
    <canvas width="0" height="0" style="border:1px solid black;display:hidden"></canvas>
    <video src="" style="left:0px;top:0px;margin:0px;background-color:black;width:100%;height:100%;border:2px solid black;position:absolute;z-index:4"></video>
    <!-- <button style="position:absolute;top:0px;left:0px;z-index:5" id=save>save</button> -->

    <div>
        <button style="position:absolute;top:0px;right:0px;z-index:2" id=close>close</button>
        <img src="" style="position:absolute;width:100%;height:100%;z-index:1;top:0px;right:0px;border:2px solid black" />
    </div>
    <script>
        var ctx = document.querySelector('canvas').getContext('2d');
        ctx.fillStyle = 'blue';
        navi = navigator;
        navi.mediaDevices.enumerateDevices().then((data) => {

            devi = data.filter((d) => d.kind === 'videoinput');
            devi = devi[0];
            obj = {
                video: {
                    deviceId: '',
                    facingMode: ['user', 'environment'],
                    height: { ideal: 1080 },
                    width: { ideal: 1920 },
                },
            };
            obj.video.deviceId = devi.deviceId;
            navigator.mediaDevices.getUserMedia(obj).then((dd) => {
                track = dd.getVideoTracks()[0];
                this.abc = track;
                console.log(abc);
                this.zozo = window.URL.createObjectURL(dd);
                console.log(zozo);
                console.log(track);
                document.querySelector('video').src = zozo;
                this.cc = document.createElement('canvas');
                const context = cc.getContext('2d');
                document.querySelector('canvas').getContext('2d').drawImage(document.querySelector('video'), 0, 0);
                console.log(document.querySelector('video').src);
                document.querySelector('button').addEventListener('click', () => {
                    document.querySelector('img').src
                })
                cc.canvasCaptureMediaStream;
                console.log();
                document.querySelector('video').addEventListener('click', () => {
                    this.cc.width = document.querySelector('video').videoWidth;
                    this.cc.height = document.querySelector('video').videoHeight;
                    t2t2 = cc.getContext('2d').drawImage(document.querySelector('video'), 0, 0);
                    result = new Promise((r) => cc.toBlob((blob) => r(blob), 'image/jpeg'));
                    result.then(dd => this.dta = dd);
                    document.querySelector('img').src = URL.createObjectURL(dta);
                    document.querySelector('video').style.zIndex = 0;

                    this.ctx.drawImage(document.querySelector('img'), 10, 10);
                })
                document.querySelector('#close').addEventListener('click', () => {
                    document.querySelector('video').style.zIndex = 4;

                })
            });


        });




    </script>

    
</body>

</html>